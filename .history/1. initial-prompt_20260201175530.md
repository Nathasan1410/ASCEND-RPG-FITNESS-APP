# ðŸš€ Role: Autonomous Senior Solutions Architect (Hackathon Specialist)

I am building **"The System"**: A gamified AI fitness RPG inspired by *Solo Leveling* mechanics (E-Rank to S-Rank), but **legally distinct** to avoid copyright infringement.

**ðŸŽ¯ The Goal:**
I have a 1-week deadline. I need you to perform a **Deep Research** to generate a **"Project Blueprint for OpenCode Execution"**.
Your output will be fed directly into an AI Agent (OpenCode) to autonomously scaffold the application.

**ðŸ› ï¸ The Tech Stack (Strict Constraints):**
- **IDE:** Google Antigravity (Cloud IDE) via OpenCode.
- **Frontend:** Next.js 14 (App Router) + Tailwind CSS + Framer Motion.
- **Backend:** Supabase (Auth, Postgres, Realtime).
- **AI Generation:** **Groq** (Llama-3-70b-Versatile) for instant JSON workout plans.
- **AI Evaluation:** **Opik** (Comet) for "LLM-as-a-Judge" tracing and XP calculation.
- **NO Web3:** Pure Web2 implementation.

---

## âš¡ Your Mission: Optimize & Complete
I have attached detailed **Draft Architectures** at the bottom of this prompt (API Contract, DB Schema, Project Context).
**DO NOT reinvent the wheel.** Use my drafts as the **Ground Truth**.
Your job is to **validate, correct, and expand** them into production-ready artifacts.

### Focus your Deep Research on these 5 Execution Pillars:

### 1. "Legally Distinct" Branding & Design System
- **IP Safety:** Suggest a specific naming convention and visual style that captures the "System" vibe (Blue/Noir/Gamified) without using protected terms like "Sung Jin-Woo" or exact anime assets.
- **Tailwind Extension:** Provide a `tailwind.config.ts` theme with specific hex codes for: `neon-blue`, `system-dark`, `rank-s-gold`, `rank-e-gray`, and `success-teal`.
- **UI Guide:** Define Framer Motion variants for the "Quest Card" entrance animation (e.g., specific spring/damping values).

### 2. Gamification Logic & Math (The "Fairness" Engine)
- **Exponential Leveling Curve:** Create a specific JavaScript math formula where XP requirements scale exponentially (Level 1 = 100 XP, Level 50 = 50,000 XP).
- **Relative Effort Scoring:** Provide the logic for the **Opik Judge** to calculate XP based on User Class.
  - *Scenario:* A "Novice" doing 10 pushups gets 100 XP. A "Tank" doing the same gets only 10 XP (because it's too easy for them).
- **Supabase Views:** Optimize my DB Draft to support **Rank-Based Leaderboards** (e.g., A view that only shows 'Silver Rank' players).

### 3. AI Agent Prompts (Groq + Opik)
- **The Architect (Groq):** Refine my System Prompt to ensure Llama-3 outputs **Strict JSON** matching the attached `API_CONTRACT_DRAFT`. It must handle "Edge Cases" (e.g., User has no equipment).
- **The Judge (Opik):** Write the specific **Opik SDK evaluation script** (TypeScript). It must:
  1. Detect "Cheating" (Statistically impossible logs).
  2. Calculate the final XP using the formula from Pillar 2.
  3. Return a "Safety Score" (0-1).

### 4. OpenCode "Master Context" Refinement
- Review my attached `PROJECT_CONTEXT.md`.
- Add a section for **"Operational Anti-Patterns"**: Explicitly tell OpenCode what NOT to do (e.g., "Do not use `useEffect` for data fetching, use Server Actions instead").

### 5. The "Batch Execution" Plan (`requirements.md`)
- Write a highly detailed `requirements.md` optimized for an Autonomous Agent.
- **Structure by Phases:**
  - *Phase 1:* Database Setup (Copy-paste SQL).
  - *Phase 2:* Onboarding Flow (The "Awakening").
  - *Phase 3:* The Core Loop (Groq Integration).
  - *Phase 4:* The Judge System (Opik Integration).
  - *Phase 5:* Leaderboards & Social.
- **Crucial:** Include specific file paths (e.g., `/server/actions/quest.ts`) in the requirements.

---

## ðŸ“Ž ATTACHED DRAFTS (CONSTRAINTS)

### [DRAFT 1: PROJECT CONTEXT]
# ðŸ›ï¸ PROJECT CONTEXT: "The System: AI Hunter Gym"

## ðŸŽ¯ Vision & Core Concept
**"The System"** is a gamified fitness application inspired by the *Solo Leveling* manhwa. It transforms the mundane task of working out into a high-stakes RPG adventure.
- **Tagline:** "Your Daily Quest to become S-Rank."
- **Goal:** Users perform daily fitness quests to gain XP, level up, and unlock classes based on real-world effort.
- **Unique Selling Point (USP):** Using **Opik AI** not just for code tracing, but as a living **"System Judge"** that evaluates user effort, calculates dynamic XP, and detects cheating.

---

## ðŸ§  The "System" Logic (Opik Integration)
Unlike traditional apps that use static XP (e.g., 1 pushup = 10 XP), **The System** uses **LLM-as-a-Judge** to evaluate performance qualitatively.

### 1. The Judge Agent (Opik)
- **Role:** The "Game Master".
- **Input:** User's Level, Class, Daily Quest Target, and User's Completion Log (Text/Voice).
- **Evaluation Logic:**
    - *Scenario:* User reports "Did 20 pushups, form was shaky at the end."
    - *Evaluation:* "User showed High Effort. Technique Low. Target Met."
    - *Output:* **Dynamic XP** (Base Reward + Effort Bonus).
- **Anti-Cheat System:**
    - The Judge analyzes logs for physical impossibility (e.g., "1000 pushups in 1 minute").
    - **Action:** Flag suspicious activity, annul XP, or issue a "Red Flag".

### 2. The Architect Agent (Planner)
- **Role:** The "Quest Giver".
- **Logic:** Generates workouts based on:
    - **Inventory:** (Gym/Home/Park/No Equipment).
    - **Condition:** (Sore/Fresh/Injured).
    - **Time Investment:** (e.g., "I only have 15 mins").
- **Persona:** Cold, Objective, Authoritative.

---

## ðŸŽ® Game Mechanics & Progression

### 1. Class System (The "Build")
Users select a class that dictates their workout style. This is injected into the Architect's System Prompt:
- **Novice (Base Builder):**
    - *Goal:* Consistency & Form.
    - *Logic:* Low penalty, XP gained from streaks.
- **Ranger/Striker (Intermediate):**
    - *Goal:* Endurance & Speed (Pick up the pace).
    - *Logic:* High volume, short rest periods.
- **Tank/Berserker (Bulking):**
    - *Goal:* Hypertrophy & Strength.
    - *Logic:* Low reps, heavy load (or difficult bodyweight variations).
- **Assassin (Cutting):**
    - *Goal:* Fat Loss & Agility.
    - *Logic:* HIIT, Cardio, High Reps, Calorie burn focus.

### 2. The User Loop
1.  **The Awakening (Onboarding):**
    - User inputs Critical Data (Height, Weight).
    - **Placement Test:** Input max pushups/run capability.
    - **Result:** System assigns Initial Rank (E-Rank to S-Rank).
2.  **Daily Check-In:**
    - User inputs Time Available & Physical Status.
    - System generates a specific **Daily Quest**.
3.  **The Grind (Execution):**
    - User performs the quest.
    - User submits a report.
4.  **Judgment:** Opik evaluates report -> Awards XP -> Updates Stats.
5.  **Level Up:**
    - Exponential XP curve.
    - Level Up triggers Rank Up (E -> D -> C...).

### 3. Gamification Elements
- **Status Window:** Hexagon chart displaying Strength, Agility, Stamina.
- **Leaderboard:** Resets every "Season" (e.g., Monthly) to keep it fair for new users.
- **Penalty Zone:** If a user skips a workout without a valid "Rest" reason, the System issues a "Penalty Quest" (e.g., Run 3km) to maintain their streak.
- **Potions (Nutrition):** MVP approach. Simple advice like "Drink Protein Potion" (Bulking) or "Avoid Sugar Potion" (Cutting).

---

## ðŸ› ï¸ Execution Strategy (Hackathon MVP)

### Tech Stack
- **Frontend:** Next.js + Tailwind CSS (Dark Mode, Neon Blue `#2563eb`, Glassmorphism).
- **Backend:** Express/Next.js Server Actions.
- **AI/Ops:** Groq (Generation) + **Opik SDK** (Evaluation/Tracing).

### Roadmap (Feb 1 - Feb 8)
- **Day 1-2 (Logic Core):**
    - Build Planner Agent (Groq).
    - Implement Dynamic XP Logic (Opik Judge).
    - Setup Database Schema.
- **Day 3-4 (UI/UX):**
    - "Solo Leveling" Aesthetics (Blue Boxes, Status Window).
    - Class Selection Screen.
    - "Quest Complete" Card for social sharing (`html-to-image`).
- **Day 5 (Integration):**
    - Connect Frontend to Opik Judge.
    - Implement "Anti-Cheat" flags.
- **Day 6 (Demo Prep):**
    - Record "Novice" to "Assassin" progression.
    - Showcase Opik Dashboard traces (Safety Score & Cheat Detection).

---

*This context defines the soul of the project. All code and logic must align with the "System" persona: Efficient, Gamified, and Fair.*

### [DRAFT 2: RULES & CONSTRAINTS]
# â›” Global Rules & Execution Constraints (The Iron Laws)

## 1. The Hackathon Protocol (Speed > Perfection)
*We have 7 days. Efficiency is the only metric that matters.*

- **NO Over-Engineering:** Do not implement "Clean Architecture", "Hexagonal", or complex "Repository Patterns". Use direct logic in Server Actions.
- **NO Unit Tests:** We do not have time for Jest/Vitest. Test manually by running the app.
- **NO Complex State:** Do not use Redux, Recoil, or Zustand. Use React Context or URL Search Params (`useSearchParams`) for state.
- **MVP First:** If a feature is "nice to have" but not in the `requirements.md`, **SKIP IT**.

---

## 2. Coding Standards (Next.js & Supabase)

### A. Server Actions over API Routes
- **Rule:** Do NOT create `/app/api/...` routes unless absolutely necessary (e.g., external Webhooks).
- **Implementation:** All database mutations (Create/Update/Delete) MUST be **Server Actions** (`/server/actions/*.ts`).
- **Data Fetching:** Fetch data directly in Server Components using Supabase Server Client.

### B. Strict TypeScript
- **Rule:** `any` type is **FORBIDDEN**.
- **Implementation:**
  - Use `Database` types generated from Supabase.
  - Use `Zod` schemas to validate all Forms and AI JSON outputs.

### C. Client vs Server Components
- **Rule:** Default to Server Components.
- **Implementation:** Add `'use client'` ONLY to leaf components that require interactivity (Buttons, Forms, Hooks). Keep data fetching on the server.

---

## 3. AI Integration Rules (Groq & Opik)

### A. The "Blindness" Prevention
- **Rule:** Never assume the LLM output is perfect.
- **Implementation:** Always wrap `JSON.parse(aiResponse)` in a `try/catch` block. If parsing fails, return a "Fallback Quest" (Hardcoded generic workout) instead of crashing the app.

### B. Observability is Mandatory
- **Rule:** Every single call to Groq MUST be wrapped in `opik.trace`.
- **Reason:** We need to debug prompt performance in real-time. Un-traced calls are invisible and useless for the Judge system.

---

## 4. UI/UX "System" Constraints

### A. No Light Mode
- **Rule:** The app is **Dark Mode ONLY**.
- **Implementation:** Hardcode `class="dark"` in the HTML root or Tailwind config. Do not build a theme toggle switch.

### B. No "Lorem Ipsum"
- **Rule:** Never generate dummy text like "Lorem ipsum dolor sit amet".
- **Implementation:** Use "System Placeholder" text.
  - *Bad:* "Description goes here."
  - *Good:* "Analyzing user biometrics... Waiting for input."

### C. No External Assets
- **Rule:** Do not import PNG/JPG files unless absolutely necessary.
- **Implementation:** Use CSS Gradients, Tailwind Borders, and `lucide-react` icons. This keeps the deployment lightweight.

---

## 5. Security & Safety

### A. RLS (Row Level Security)
- **Rule:** Never deploy a Supabase table without RLS enabled.
- **Constraint:** Users can only view/edit *their own* data. Leaderboards are the only exception (Public Read).

### B. Env Variables
- **Rule:** Never hardcode API keys.
- **Implementation:** Access keys via `process.env.NEXT_PUBLIC_SUPABASE_URL` etc. Verify they exist at app startup; crash if missing.

---

*Adhere to these rules strictly. Any deviation requires explicit user override.*

### [DRAFT 3: FOLDER STRUCTURE]

# ðŸ“‚ Project Folder Structure (Next.js 14 App Router)

This structure enforces a clean separation between **UI (Client)**, **Logic (Server Actions)**, and **AI Services**.

## 1. App Router (`/app`)
*Pages and Layouts.*

- **/app**
  - `layout.tsx`: Root layout (Font, ThemeProvider, Toast).
  - `page.tsx`: Landing Page ("Enter the System").
  - `globals.css`: Tailwind directives & Custom "System" animations.
  
  - **/auth**
    - `/login/page.tsx`: System Entry (Auth UI).
    - `/callback/route.ts`: Supabase Auth Callback.
    
  - **/onboarding** (The Awakening)
    - `page.tsx`: Initial Status Check (Form Wizard).
    - `layout.tsx`: Focus layout (No navbar).
    
  - **/dashboard** (The System Interface)
    - `layout.tsx`: Sidebar/Bottom Nav + "System" Header.
    - `page.tsx`: Main Hub (Current Quest, Status Window).
    - `/quest/[id]/page.tsx`: Active Quest Execution Mode.
    - `/leaderboard/page.tsx`: Global Ranking.
    - `/profile/page.tsx`: Hunter Profile & Stats.

## 2. Components (`/components`)
*Reusable UI elements.*

- **/ui** (Shadcn Primitives)
  - `button.tsx`, `card.tsx`, `progress.tsx`, `dialog.tsx`, `skeleton.tsx`
  - `toast.tsx` (Sonner/Toaster)

- **/quest** (Workout Specific)
  - `QuestCard.tsx`: The "Daily Quest" glass card.
  - `ExerciseItem.tsx`: Individual exercise row with checkbox.
  - `QuestTimer.tsx`: Countdown/Stopwatch for workout.
  - `CompletionForm.tsx`: Feedback form (RPE input).

- **/gamification** (RPG Elements)
  - `StatusWindow.tsx`: Hexagon Chart (Recharts/Tremor) for stats.
  - `RankBadge.tsx`: Visual badge for E-Rank to S-Rank.
  - `XPBar.tsx`: Animated progress bar with level-up effect.
  - `ClassIcon.tsx`: Icons for Tank/Assassin/etc.

- **/layout**
  - `SystemNavbar.tsx`: Top navigation.
  - `SystemSidebar.tsx`: Desktop navigation.

## 3. Libraries & Config (`/lib`)
*Utilities and 3rd party clients.*

- **/supabase**
  - `client.ts`: Browser client.
  - `server.ts`: Server Component client (cookies).
  - `middleware.ts`: Auth protection logic.

- **/ai** (The Brain)
  - `groq.ts`: Groq SDK client instance.
  - `opik.ts`: Opik SDK client instance.
  - `prompts.ts`: **CRITICAL.** Stores the long System Prompts for Architect & Judge agents.

- **/utils**
  - `cn.ts`: Tailwind class merger.
  - `xp-logic.ts`: The math formula for XP calculation (Shared logic).
  - `date-helpers.ts`: Formatters for logs.

## 4. Server Logic (`/server`)
*Server Actions (Backend Logic).*

- **/actions**
  - `auth-actions.ts`: Handle Sign-up triggers.
  - `quest-actions.ts`: `generateDailyQuest()`, `fetchActiveQuest()`.
  - `log-actions.ts`: `submitQuestLog()` -> Triggers Opik Evaluation.
  - `profile-actions.ts`: `updateOnboarding()`.

## 5. Types (`/types`)
*TypeScript Definitions.*

- `database.types.ts`: Auto-generated from Supabase.
- `api.types.ts`: The **API Contract** interfaces (WorkoutPlan, EvaluationResult).
- `schemas.ts`: Zod schemas for form validation.

### [DRAFT 4: DATABASE SCHEMA]

*(Paste isi `db-schema.md` di sini. Tulang punggung data.)*

### [DRAFT 5: API CONTRACT]

*(Paste isi `api-schema.md` di sini. Bahasa komunikasi antar Frontend, Backend, dan AI.)*

### [DRAFT 6: ARCHITECT AGENT (GROQ)]

*(Paste isi `ai-agent-build.md` di sini. Logic untuk generate workout.)*

### [DRAFT 7: JUDGE AGENT (OPIK)]

*(Paste isi `evaluation-schema.md` di sini. Logic untuk validasi dan XP.)*

### [DRAFT 8: FRONTEND GUIDELINES]

*(Paste isi `frontend-guidance.md` di sini. Panduan visual "Solo Leveling".)*